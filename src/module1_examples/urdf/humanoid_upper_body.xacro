<?xml version="1.0"?>
<robot name="humanoid_upper_body" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="PI" value="3.14159265359"/>
  <xacro:property name="shoulder_mass" value="0.01"/>
  <xacro:property name="shoulder_link_size" value="0.001"/>
  <xacro:property name="shoulder_joint_effort" value="50"/>

  <link name="torso">
    <visual><geometry><box size="0.25 0.35 0.5"/></geometry><material name="TorsoColor"><color rgba="0.4 0.4 0.4 1"/></material></visual>
    <inertial><mass value="15.0"/><inertia ixx="0.5" ixy="0" ixz="0" iyy="0.5" iyz="0" izz="0.2"/></inertial>
  </link>

  <xacro:macro name="spherical_joint_3dof" params="prefix parent_link roll_origin_xyz">
    
    <joint name="${prefix}_roll_joint" type="revolute">
      <parent link="${parent_link}"/>
      <child link="${prefix}_roll_link"/>
      <origin xyz="${roll_origin_xyz}" rpy="0 0 0"/>
      <axis xyz="1 0 0"/>
      <limit effort="${shoulder_joint_effort}" velocity="1.0" lower="-${PI/2}" upper="${PI/2}"/>
    </joint>
    <link name="${prefix}_roll_link">
        <inertial><mass value="${shoulder_mass}"/><inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/></inertial>
        <visual><geometry><box size="${shoulder_link_size} ${shoulder_link_size} ${shoulder_link_size}"/></geometry></visual>
    </link>

    <joint name="${prefix}_pitch_joint" type="revolute">
      <parent link="${prefix}_roll_link"/>
      <child link="${prefix}_pitch_link"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="${shoulder_joint_effort}" velocity="1.0" lower="-1.5" upper="1.5"/>
    </joint>
    <link name="${prefix}_pitch_link">
        <inertial><mass value="${shoulder_mass}"/><inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/></inertial>
        <visual><geometry><box size="${shoulder_link_size} ${shoulder_link_size} ${shoulder_link_size}"/></geometry></visual>
    </link>

    <joint name="${prefix}_yaw_joint" type="revolute">
      <parent link="${prefix}_pitch_link"/>
      <child link="${prefix}_arm_base"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit effort="${shoulder_joint_effort}" velocity="1.0" lower="-${PI}" upper="${PI}"/>
    </joint>
    
    <link name="${prefix}_arm_base">
        <visual><geometry><sphere radius="0.06"/></geometry><material name="JointColor"><color rgba="0 1 0 1"/></material></visual>
        <inertial><mass value="0.1"/><inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/></inertial>
    </link>

  </xacro:macro>

  <xacro:spherical_joint_3dof 
    prefix="right_shoulder" 
    parent_link="torso" 
    roll_origin_xyz="0 -0.18 0.4"/>

  <xacro:spherical_joint_3dof 
    prefix="left_shoulder" 
    parent_link="torso" 
    roll_origin_xyz="0 0.18 0.4"/>

</robot>